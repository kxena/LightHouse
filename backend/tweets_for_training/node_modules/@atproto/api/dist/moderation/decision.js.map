{"version":3,"file":"decision.js","sourceRoot":"","sources":["../../src/moderation/decision.ts"],"names":[],"mappings":"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","sourcesContent":["import { AppBskyGraphDefs } from '../client/index'\nimport { LABELS } from './const/labels'\nimport { MuteWordMatch } from './mutewords'\nimport {\n  BLOCK_BEHAVIOR,\n  CUSTOM_LABEL_VALUE_RE,\n  HIDE_BEHAVIOR,\n  Label,\n  LabelPreference,\n  LabelTarget,\n  MUTEWORD_BEHAVIOR,\n  MUTE_BEHAVIOR,\n  ModerationBehavior,\n  ModerationCause,\n  ModerationOpts,\n  NOOP_BEHAVIOR,\n} from './types'\nimport { ModerationUI } from './ui'\n\nenum ModerationBehaviorSeverity {\n  High,\n  Medium,\n  Low,\n}\n\nexport class ModerationDecision {\n  did = ''\n  isMe = false\n  causes: ModerationCause[] = []\n\n  constructor() {}\n\n  static merge(\n    ...decisions: (ModerationDecision | undefined)[]\n  ): ModerationDecision {\n    const decisionsFiltered = decisions.filter((v) => v != null)\n    const decision = new ModerationDecision()\n    if (decisionsFiltered[0]) {\n      decision.did = decisionsFiltered[0].did\n      decision.isMe = decisionsFiltered[0].isMe\n    }\n    decision.causes = decisionsFiltered.flatMap((d) => d.causes)\n    return decision\n  }\n\n  downgrade() {\n    for (const cause of this.causes) {\n      cause.downgraded = true\n    }\n    return this\n  }\n\n  get blocked() {\n    return !!this.blockCause\n  }\n\n  get muted() {\n    return !!this.muteCause\n  }\n\n  get blockCause() {\n    return this.causes.find(\n      (cause) =>\n        cause.type === 'blocking' ||\n        cause.type === 'blocked-by' ||\n        cause.type === 'block-other',\n    )\n  }\n\n  get muteCause() {\n    return this.causes.find((cause) => cause.type === 'muted')\n  }\n\n  get labelCauses() {\n    return this.causes.filter((cause) => cause.type === 'label')\n  }\n\n  ui(context: keyof ModerationBehavior): ModerationUI {\n    const ui = new ModerationUI()\n    for (const cause of this.causes) {\n      if (\n        cause.type === 'blocking' ||\n        cause.type === 'blocked-by' ||\n        cause.type === 'block-other'\n      ) {\n        if (this.isMe) {\n          continue\n        }\n        if (context === 'profileList' || context === 'contentList') {\n          ui.filters.push(cause)\n        }\n        if (!cause.downgraded) {\n          if (BLOCK_BEHAVIOR[context] === 'blur') {\n            ui.noOverride = true\n            ui.blurs.push(cause)\n          } else if (BLOCK_BEHAVIOR[context] === 'alert') {\n            ui.alerts.push(cause)\n          } else if (BLOCK_BEHAVIOR[context] === 'inform') {\n            ui.informs.push(cause)\n          }\n        }\n      } else if (cause.type === 'muted') {\n        if (this.isMe) {\n          continue\n        }\n        if (context === 'profileList' || context === 'contentList') {\n          ui.filters.push(cause)\n        }\n        if (!cause.downgraded) {\n          if (MUTE_BEHAVIOR[context] === 'blur') {\n            ui.blurs.push(cause)\n          } else if (MUTE_BEHAVIOR[context] === 'alert') {\n            ui.alerts.push(cause)\n          } else if (MUTE_BEHAVIOR[context] === 'inform') {\n            ui.informs.push(cause)\n          }\n        }\n      } else if (cause.type === 'mute-word') {\n        if (this.isMe) {\n          continue\n        }\n        if (context === 'contentList') {\n          ui.filters.push(cause)\n        }\n        if (!cause.downgraded) {\n          if (MUTEWORD_BEHAVIOR[context] === 'blur') {\n            ui.blurs.push(cause)\n          } else if (MUTEWORD_BEHAVIOR[context] === 'alert') {\n            ui.alerts.push(cause)\n          } else if (MUTEWORD_BEHAVIOR[context] === 'inform') {\n            ui.informs.push(cause)\n          }\n        }\n      } else if (cause.type === 'hidden') {\n        if (context === 'profileList' || context === 'contentList') {\n          ui.filters.push(cause)\n        }\n        if (!cause.downgraded) {\n          if (HIDE_BEHAVIOR[context] === 'blur') {\n            ui.blurs.push(cause)\n          } else if (HIDE_BEHAVIOR[context] === 'alert') {\n            ui.alerts.push(cause)\n          } else if (HIDE_BEHAVIOR[context] === 'inform') {\n            ui.informs.push(cause)\n          }\n        }\n      } else if (cause.type === 'label') {\n        if (context === 'profileList' && cause.target === 'account') {\n          if (cause.setting === 'hide' && !this.isMe) {\n            ui.filters.push(cause)\n          }\n        } else if (\n          context === 'contentList' &&\n          (cause.target === 'account' || cause.target === 'content')\n        ) {\n          if (cause.setting === 'hide' && !this.isMe) {\n            ui.filters.push(cause)\n          }\n        }\n        if (!cause.downgraded) {\n          if (cause.behavior[context] === 'blur') {\n            ui.blurs.push(cause)\n            if (cause.noOverride && !this.isMe) {\n              ui.noOverride = true\n            }\n          } else if (cause.behavior[context] === 'alert') {\n            ui.alerts.push(cause)\n          } else if (cause.behavior[context] === 'inform') {\n            ui.informs.push(cause)\n          }\n        }\n      }\n    }\n\n    ui.filters.sort(sortByPriority)\n    ui.blurs.sort(sortByPriority)\n\n    return ui\n  }\n\n  setDid(did: string) {\n    this.did = did\n  }\n\n  setIsMe(isMe: boolean) {\n    this.isMe = isMe\n  }\n\n  addHidden(hidden: boolean) {\n    if (hidden) {\n      this.causes.push({\n        type: 'hidden',\n        source: { type: 'user' },\n        priority: 6,\n      })\n    }\n  }\n\n  addMutedWord(matches: MuteWordMatch[] | undefined) {\n    if (matches?.length) {\n      this.causes.push({\n        type: 'mute-word',\n        source: { type: 'user' },\n        priority: 6,\n        matches,\n      })\n    }\n  }\n\n  addBlocking(blocking: string | undefined) {\n    if (blocking) {\n      this.causes.push({\n        type: 'blocking',\n        source: { type: 'user' },\n        priority: 3,\n      })\n    }\n  }\n\n  addBlockingByList(\n    blockingByList: AppBskyGraphDefs.ListViewBasic | undefined,\n  ) {\n    if (blockingByList) {\n      this.causes.push({\n        type: 'blocking',\n        source: { type: 'list', list: blockingByList },\n        priority: 3,\n      })\n    }\n  }\n\n  addBlockedBy(blockedBy: boolean | undefined) {\n    if (blockedBy) {\n      this.causes.push({\n        type: 'blocked-by',\n        source: { type: 'user' },\n        priority: 4,\n      })\n    }\n  }\n\n  addBlockOther(blockOther: boolean | undefined) {\n    if (blockOther) {\n      this.causes.push({\n        type: 'block-other',\n        source: { type: 'user' },\n        priority: 4,\n      })\n    }\n  }\n\n  addLabel(target: LabelTarget, label: Label, opts: ModerationOpts) {\n    // look up the label definition\n    const labelDef = CUSTOM_LABEL_VALUE_RE.test(label.val)\n      ? opts.labelDefs?.[label.src]?.find(\n          (def) => def.identifier === label.val,\n        ) || LABELS[label.val]\n      : LABELS[label.val]\n    if (!labelDef) {\n      // ignore labels we don't understand\n      return\n    }\n\n    // look up the label preference\n    const isSelf = label.src === this.did\n    const labeler = isSelf\n      ? undefined\n      : opts.prefs.labelers.find((s) => s.did === label.src)\n\n    if (!isSelf && !labeler) {\n      return // skip labelers not configured by the user\n    }\n    if (isSelf && labelDef.flags.includes('no-self')) {\n      return // skip self-labels that aren't supported\n    }\n\n    // establish the label preference for interpretation\n    let labelPref: LabelPreference = labelDef.defaultSetting || 'ignore'\n    if (!labelDef.configurable) {\n      labelPref = labelDef.defaultSetting || 'hide'\n    } else if (\n      labelDef.flags.includes('adult') &&\n      !opts.prefs.adultContentEnabled\n    ) {\n      labelPref = 'hide'\n    } else if (labeler?.labels[labelDef.identifier]) {\n      labelPref = labeler?.labels[labelDef.identifier]\n    } else if (opts.prefs.labels[labelDef.identifier]) {\n      labelPref = opts.prefs.labels[labelDef.identifier]\n    }\n\n    // ignore labels the user has asked to ignore\n    if (labelPref === 'ignore') {\n      return\n    }\n\n    // ignore 'unauthed' labels when the user is authed\n    if (labelDef.flags.includes('unauthed') && !!opts.userDid) {\n      return\n    }\n\n    // establish the priority of the label\n    let priority: 1 | 2 | 5 | 7 | 8\n    const severity = measureModerationBehaviorSeverity(\n      labelDef.behaviors[target],\n    )\n    if (\n      labelDef.flags.includes('no-override') ||\n      (labelDef.flags.includes('adult') && !opts.prefs.adultContentEnabled)\n    ) {\n      priority = 1\n    } else if (labelPref === 'hide') {\n      priority = 2\n    } else if (severity === ModerationBehaviorSeverity.High) {\n      // blurring profile view or content view\n      priority = 5\n    } else if (severity === ModerationBehaviorSeverity.Medium) {\n      // blurring content list or content media\n      priority = 7\n    } else {\n      // blurring avatar, adding alerts\n      priority = 8\n    }\n\n    let noOverride = false\n    if (labelDef.flags.includes('no-override')) {\n      noOverride = true\n    } else if (\n      labelDef.flags.includes('adult') &&\n      !opts.prefs.adultContentEnabled\n    ) {\n      noOverride = true\n    }\n\n    this.causes.push({\n      type: 'label',\n      source:\n        isSelf || !labeler\n          ? { type: 'user' }\n          : { type: 'labeler', did: labeler.did },\n      label,\n      labelDef,\n      target,\n      setting: labelPref,\n      behavior: labelDef.behaviors[target] || NOOP_BEHAVIOR,\n      noOverride,\n      priority,\n    })\n  }\n\n  addMuted(muted: boolean | undefined) {\n    if (muted) {\n      this.causes.push({\n        type: 'muted',\n        source: { type: 'user' },\n        priority: 6,\n      })\n    }\n  }\n\n  addMutedByList(mutedByList: AppBskyGraphDefs.ListViewBasic | undefined) {\n    if (mutedByList) {\n      this.causes.push({\n        type: 'muted',\n        source: { type: 'list', list: mutedByList },\n        priority: 6,\n      })\n    }\n  }\n}\n\nfunction measureModerationBehaviorSeverity(\n  beh: ModerationBehavior | undefined,\n): ModerationBehaviorSeverity {\n  if (!beh) {\n    return ModerationBehaviorSeverity.Low\n  }\n  if (beh.profileView === 'blur' || beh.contentView === 'blur') {\n    return ModerationBehaviorSeverity.High\n  }\n  if (beh.contentList === 'blur' || beh.contentMedia === 'blur') {\n    return ModerationBehaviorSeverity.Medium\n  }\n  return ModerationBehaviorSeverity.Low\n}\n\nfunction sortByPriority(a: ModerationCause, b: ModerationCause) {\n  return a.priority - b.priority\n}\n"]}